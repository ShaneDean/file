# 前言
在移植VDSM到申威raise系统的时候会碰到对某些内核配置项的依赖问题，这里把申威内核的移植步骤记录一下，方便以后查阅

# 主要步骤
1.     替换对应的hmcode
2.     修改对应的grub.cfg
3.     重新编译内核、安装模块

## hmcode
因为申威是从alpha继承过来的，所以这里的Hmcode是类似于PALcode的代码。主要完成一些硬件实现较为复杂的底层基础功能，由于在增加Kvmn内核模块的过程中对hmcode的部分功能有修改功能，所以需要选择KVM对应的hmcode版本。

首先打开申威服务器主板，查找ipmi卡上的调试端口，将对应的Hmcode刷到主板上。


***详细部分待细化***


## boot
修改grub.cfg文件

选择对应的boot.img、bootloader.bin和vmlinux

由于在支持KVM的过程中，内核中的相关的几个地址出现了修改，所以上面的三个文件都应该对应调整。

如果版本选择正确，此时重启主机应该就可以支持虚拟化功能。

## 编译内核
目前申威内核的同事们重点在研发Kvm内核模块的功能，对应特殊需求的内核选项没法完全覆盖，需要自行进行编译裁剪。
使自定义的交叉编译mk进行内核编译。

./mk menuconfig
./mk -j 16
./mk modules_install 指定module的地址